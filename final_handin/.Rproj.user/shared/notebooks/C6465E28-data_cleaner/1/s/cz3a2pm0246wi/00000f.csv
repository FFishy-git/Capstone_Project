"0","# load the data from ""data/IPEDS_filled.csv"""
"0","data <- read.csv(""data/cleaned/IPEDS_filled.csv"")"
"0",""
"0","# estimate the posterior Gaussian using the columns:"
"0","  # SAT Critical Reading 25th percentile score	"
"0","  # SAT Critical Reading 75th percentile score	"
"0","  # SAT Math 25th percentile score	"
"0","  # SAT Math 75th percentile score	"
"0","  # SAT Writing 25th percentile score	"
"0","  # SAT Writing 75th percentile score	"
"0","  # ACT Composite 25th percentile score	"
"0","  # ACT Composite 75th percentile score"
"0",""
"0","# item_list = [""SAT.Critical.Reading"", ""SAT.Math"", ""SAT.Writing"", ""ACT.Composite""], mu, and sd"
"0","item_list <- c(""SAT.Critical.Reading"", ""SAT.Math"", ""SAT.Writing"", ""ACT.Composite"")"
"0","test_scores_summary <- list("
"0","  SAT.Critical.Reading = list(mean = 496, sd = 115),"
"0","  SAT.Math = list(mean = 514, sd = 118),"
"0","  SAT.Writing = list(mean = 488, sd = 114),"
"0","  ACT.Composite = list(mean = 20.9, sd = 5.4)"
"0",")"
"0",""
"0","# Read the columns with the number ""Enrolled total"" for each school "
"0","enrolled_total <- data[[""Enrolled.total""]]"
"0",""
"0","# read the corresponding columns by looping through the item_list"
"0","for (i in 1:length(item_list)) {"
"0","  # get the 25th percentile score"
"0","  q25 <- data[[paste(item_list[i], ""25th.percentile.score"", sep = ""."")]]"
"0","  # get the 75th percentile score"
"0","  q75 <- data[[paste(item_list[i], ""75th.percentile.score"", sep = ""."")]]"
"0","  "
"0","  # get the z-scores for the 25% and 75% quantiles"
"0","  z25 <- qnorm(0.25)"
"0","  z75 <- qnorm(0.75)"
"0","  "
"0","  # Estimate the mean and standard deviation"
"0","  mean_est <- (q25 + q75) / 2"
"0","  sd_est <- (q75 - mean_est) / z75"
"0","  "
"0","  # get the prior mean and standard deviation from the test_scores_summary"
"0","  mu <- test_scores_summary[[item_list[i]]][[""mean""]]"
"0","  sd <- test_scores_summary[[item_list[i]]][[""sd""]]"
"0","  "
"0","  # estimate the standard deviation of the likelihood model"
"0","  sd1_sq <- 1 / (1 / sd_est ^ 2 - 1 / sd ^ 2)"
"0","  # set the nan and negative values to infinity, since these schools' admission likelihood has low dependency on this test score in our later model, we'll set the model to be constant one for these schools and test scores."
"0","  sd1_sq[is.nan(sd1_sq) | sd1_sq < 0] <- Inf"
"0","  sd1 = sqrt(sd1_sq)"
"0","  "
"0","  # estimate the mean of the likelihood model"
"0","  mu1 = (mu + mean_est * (sd / sd1) ^ 2) / (1 + (sd / sd1) ^ 2)"
"0","  "
"0","  # store mu1 and sd1 into the data as a new column"
"0","  data[, paste(item_list[i], ""likelihood.mean"", sep = ""."")] <- c(mu1)"
"0","  data[, paste(item_list[i], ""likelihood.sd"", sep = ""."")] <- c(sd1)"
"0","  "
"0","  # print the number of schools with sd > sd_est"
"0","  print(paste(""The number of schools with sd > sd_est for"", item_list[i], ""is"", sum(sd > sd_est), ""/"", nrow(data)))"
"0","}"
"1","[1]"
"1"," ""The number of schools with sd > sd_est for SAT.Critical.Reading is 462 / 469"""
"1","
"
"1","[1]"
"1"," ""The number of schools with sd > sd_est for SAT.Math is 460 / 469"""
"1","
"
"1","[1]"
"1"," ""The number of schools with sd > sd_est for SAT.Writing is 467 / 469"""
"1","
"
"1","[1]"
"1"," ""The number of schools with sd > sd_est for ACT.Composite is 464 / 469"""
"1","
"
"0","# store the data"
"0","write.csv(data, ""data/cleaned/IPEDS_filled.csv"", row.names = FALSE)"
